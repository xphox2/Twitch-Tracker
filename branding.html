<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Modular Branding Settings</title>
    <link id="google-font-link" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 30px;
            color: #fff;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #a0aec0;
            margin-bottom: 30px;
        }

        .container {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 30px;
            max-width: 1600px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group {
            margin-bottom: 16px;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            color: #a0aec0;
            margin-bottom: 6px;
        }

        .color-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-input-wrapper input[type="text"] {
            display: none;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 2px;
        }

        input[type="color"]::-webkit-color-swatch {
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        input[type="text"] {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 10px;
            color: #fff;
            font-size: 13px;
            font-family: monospace;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #9146ff;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #9146ff;
            cursor: pointer;
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .range-value {
            text-align: right;
            font-size: 11px;
            color: #a0aec0;
            margin-top: 4px;
        }

        select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 10px;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #9146ff;
        }

        option {
            background: #1a1a2e;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #9146ff;
            color: #fff;
        }

        .btn-primary:hover {
            background: #7c3aed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .preview-section {
            position: sticky;
            top: 30px;
        }

        .preview-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #a0aec0;
            transition: all 0.2s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab.active {
            background: #9146ff;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            display: none;
        }

        .status-message.success {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
            display: block;
        }

        .status-message.error {
            background: rgba(245, 101, 101, 0.2);
            color: #f56565;
            display: block;
        }

        .color-presets {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .preset-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .preset-btn:hover {
            transform: scale(1.1);
            border-color: #fff;
        }

        .section-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #9146ff;
        }

        .checkbox-wrapper label {
            margin: 0;
            cursor: pointer;
            font-size: 13px;
        }

        .font-preview {
            margin-top: 10px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-box {
            background: rgba(145, 70, 255, 0.1);
            border: 1px solid rgba(145, 70, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 12px;
            color: #a0aec0;
        }

        .info-box strong {
            color: #fff;
        }

        .info-box code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
        }

        /* Widget-specific control panels */
        .widget-section {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .widget-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .widget-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .control-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .control-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .control-small label {
            font-size: 11px;
        }

        /* Preview Styles */
        .sidebar2-preview {
            display: flex;
            flex-direction: column;
            gap: var(--preview-gap, 5px);
            max-width: 280px;
            font-family: var(--preview-font-family, 'Bebas Neue', sans-serif);
        }

        .preview-widget {
            min-width: 180px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 5px;
            opacity: 1;
        }

        .preview-widget.followers {
            background: var(--followers-bg, rgba(0,0,0,0));
            border-radius: var(--followers-radius, 0);
            padding: var(--followers-padding, 8px 15px);
            border: var(--followers-border-width, 2px) var(--followers-border-style, solid) var(--followers-border-color, #9146ff);
        }

        .preview-widget.followers .preview-value {
            color: var(--followers-text, #9146ff);
            font-size: var(--followers-size, 48px);
        }

        .preview-widget.followers .preview-label {
            color: var(--followers-label, #aaaaaa);
            font-size: var(--followers-label-size, 14px);
        }

        .preview-widget.subgoal {
            background: var(--subgoal-bg, rgba(0,0,0,0));
            border-radius: var(--subgoal-radius, 0);
            padding: var(--subgoal-padding, 8px 15px);
            border: var(--subgoal-border-width, 2px) var(--subgoal-border-style, solid) var(--subgoal-border-color, #00d2d3);
        }

        .preview-widget.subgoal .preview-value {
            color: var(--subgoal-text, #00d2d3);
            font-size: var(--subgoal-size, 42px);
        }

        .preview-widget.subgoal .preview-label {
            color: var(--subgoal-label, #aaaaaa);
            font-size: var(--subgoal-label-size, 14px);
        }

        .preview-widget.bits {
            background: var(--bits-bg, rgba(0,0,0,0));
            border-radius: var(--bits-radius, 0);
            padding: var(--bits-padding, 8px 15px);
            border: var(--bits-border-width, 2px) var(--bits-border-style, solid) var(--bits-border-color, #2ed573);
        }

        .preview-widget.bits .preview-value {
            color: var(--bits-text, #2ed573);
            font-size: var(--bits-size, 42px);
        }

        .preview-widget.bits .preview-label {
            color: var(--bits-label, #aaaaaa);
            font-size: var(--bits-label-size, 14px);
        }

        .preview-widget.monthly {
            background: var(--monthly-bg, rgba(0,0,0,0));
            border-radius: var(--monthly-radius, 0);
            padding: var(--monthly-padding, 8px 15px);
            border: var(--monthly-border-width, 2px) var(--monthly-border-style, solid) var(--monthly-border-color, #ff6b6b);
        }

        .preview-widget.monthly .preview-value {
            color: var(--monthly-text, #ff6b6b);
            font-size: var(--monthly-size, 42px);
        }

        .preview-widget.monthly .preview-label {
            color: var(--monthly-label, #aaaaaa);
            font-size: var(--monthly-label-size, 14px);
        }

        .preview-widget.lifetime {
            background: var(--lifetime-bg, rgba(0,0,0,0));
            border-radius: var(--lifetime-radius, 0);
            padding: var(--lifetime-padding, 8px 15px);
            border: var(--lifetime-border-width, 2px) var(--lifetime-border-style, solid) var(--lifetime-border-color, #ffd700);
        }

        .preview-widget.lifetime .preview-value {
            color: var(--lifetime-text, #ffd700);
            font-size: var(--lifetime-size, 36px);
        }

        .preview-widget.lifetime .preview-label {
            color: var(--lifetime-label, #aaaaaa);
            font-size: var(--lifetime-label-size, 14px);
        }

        .preview-label, .preview-value {
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            opacity: 1 !important;
        }

        .preview-label {
            text-transform: uppercase;
        }

        .scrollable-panel {
            max-height: 85vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .scrollable-panel::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .scrollable-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .scrollable-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Modular Branding Settings</h1>
    <p class="subtitle">Each widget has independent styling controls</p>

    <div class="container">
        <div class="controls scrollable-panel">
            <div class="panel">
                <div class="info-box">
                    <strong>ðŸŽ¨ Modular Styling!</strong> Each widget (Followers, Monthly, Lifetime) now has completely independent colors, borders, and backgrounds.
                </div>

                <h2>Global Typography</h2>

                <div class="control-group">
                    <label>Font Family (Google Fonts)</label>
                    <select id="font-family">
                        <optgroup label="Popular Display Fonts">
                            <option value="Bebas Neue">Bebas Neue</option>
                            <option value="Oswald">Oswald</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                        </optgroup>
                        <optgroup label="Gaming/Modern">
                            <option value="Orbitron">Orbitron</option>
                            <option value="Russo One">Russo One</option>
                            <option value="Black Ops One">Black Ops One</option>
                            <option value="Press Start 2P">Press Start 2P</option>
                            <option value="Bungee">Bungee</option>
                        </optgroup>
                        <optgroup label="Elegant/Professional">
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Lato">Lato</option>
                            <option value="Raleway">Raleway</option>
                            <option value="Nunito">Nunito</option>
                            <option value="Work Sans">Work Sans</option>
                        </optgroup>
                        <optgroup label="Fun/Unique">
                            <option value="Lobster">Lobster</option>
                            <option value="Pacifico">Pacifico</option>
                            <option value="Permanent Marker">Permanent Marker</option>
                            <option value="Righteous">Righteous</option>
                            <option value="Fredoka One">Fredoka One</option>
                        </optgroup>
                        <optgroup label="System Fonts">
                            <option value="Segoe UI">Segoe UI (Default)</option>
                            <option value="Arial">Arial</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Impact">Impact</option>
                        </optgroup>
                    </select>
                    <div class="font-preview" id="font-preview">Sample Text 123</div>
                </div>

                <div class="control-group">
                    <label>Widget Gap</label>
                    <input type="range" id="gap" min="0" max="20" value="5">
                    <div class="range-value"><span id="gap-display">5</span>px</div>
                </div>

                <div class="section-divider"></div>

                <!-- Followers Widget -->
                <div class="widget-section">
                    <h3><span class="widget-color" style="background: #9146ff;"></span> Followers Widget</h3>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="followers-text-color-picker" value="#9146ff">
                                <input type="text" id="followers-text-color" value="#9146ff">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Label Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="followers-label-color-picker" value="#aaaaaa">
                                <input type="text" id="followers-label-color" value="#aaaaaa">
                            </div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Border Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="followers-border-color-picker" value="#9146ff">
                                <input type="text" id="followers-border-color" value="#9146ff">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Background</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="followers-bg-enabled">
                                <label for="followers-bg-enabled">Enable BG</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="followers-bg-color-group" style="display: none;">
                        <label>Background Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="followers-bg-color-picker" value="#000000">
                            <input type="text" id="followers-bg-color" value="rgba(0,0,0,0.3)">
                        </div>
                        <div class="control-group" style="margin-top: 10px;">
                            <label>Background Opacity</label>
                            <input type="range" id="followers-bg-opacity" min="0" max="100" value="30">
                            <div class="range-value"><span id="followers-bg-opacity-display">30</span>%</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Text Size</label>
                            <input type="range" id="followers-font-size" min="20" max="150" value="48">
                            <div class="range-value"><span id="followers-font-size-display">48</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Label Size</label>
                            <input type="range" id="followers-label-font-size" min="10" max="60" value="14">
                            <div class="range-value"><span id="followers-label-font-size-display">14</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Border</label>
                            <input type="range" id="followers-border-width" min="0" max="10" value="2">
                            <div class="range-value"><span id="followers-border-width-display">2</span>px</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Radius</label>
                            <input type="range" id="followers-border-radius" min="0" max="30" value="0">
                            <div class="range-value"><span id="followers-border-radius-display">0</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad V</label>
                            <input type="range" id="followers-padding-v" min="0" max="30" value="8">
                            <div class="range-value"><span id="followers-padding-v-display">8</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad H</label>
                            <input type="range" id="followers-padding-h" min="0" max="40" value="15">
                            <div class="range-value"><span id="followers-padding-h-display">15</span>px</div>
                        </div>
                    </div>
                </div>

                <!-- Subscriber Goal Widget -->
                <div class="widget-section">
                    <h3><span class="widget-color" style="background: #00d2d3;"></span> Subscriber Goal Widget</h3>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="subgoal-text-color-picker" value="#00d2d3">
                                <input type="text" id="subgoal-text-color" value="#00d2d3">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Label Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="subgoal-label-color-picker" value="#aaaaaa">
                                <input type="text" id="subgoal-label-color" value="#aaaaaa">
                            </div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Border Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="subgoal-border-color-picker" value="#00d2d3">
                                <input type="text" id="subgoal-border-color" value="#00d2d3">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Background</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="subgoal-bg-enabled">
                                <label for="subgoal-bg-enabled">Enable BG</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="subgoal-bg-color-group" style="display: none;">
                        <label>Background Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="subgoal-bg-color-picker" value="#000000">
                            <input type="text" id="subgoal-bg-color" value="rgba(0,0,0,0.3)">
                        </div>
                        <div class="control-group" style="margin-top: 10px;">
                            <label>Background Opacity</label>
                            <input type="range" id="subgoal-bg-opacity" min="0" max="100" value="30">
                            <div class="range-value"><span id="subgoal-bg-opacity-display">30</span>%</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Text Size</label>
                            <input type="range" id="subgoal-font-size" min="20" max="150" value="42">
                            <div class="range-value"><span id="subgoal-font-size-display">42</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Label Size</label>
                            <input type="range" id="subgoal-label-font-size" min="10" max="60" value="14">
                            <div class="range-value"><span id="subgoal-label-font-size-display">14</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Border</label>
                            <input type="range" id="subgoal-border-width" min="0" max="10" value="2">
                            <div class="range-value"><span id="subgoal-border-width-display">2</span>px</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Radius</label>
                            <input type="range" id="subgoal-border-radius" min="0" max="30" value="0">
                            <div class="range-value"><span id="subgoal-border-radius-display">0</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad V</label>
                            <input type="range" id="subgoal-padding-v" min="0" max="30" value="8">
                            <div class="range-value"><span id="subgoal-padding-v-display">8</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad H</label>
                            <input type="range" id="subgoal-padding-h" min="0" max="40" value="15">
                            <div class="range-value"><span id="subgoal-padding-h-display">15</span>px</div>
                        </div>
                    </div>
                </div>

                <!-- Bits Today Widget -->
                <div class="widget-section">
                    <h3><span class="widget-color" style="background: #2ed573;"></span> Bits Today Widget</h3>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="bits-text-color-picker" value="#2ed573">
                                <input type="text" id="bits-text-color" value="#2ed573">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Label Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="bits-label-color-picker" value="#aaaaaa">
                                <input type="text" id="bits-label-color" value="#aaaaaa">
                            </div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Border Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="bits-border-color-picker" value="#2ed573">
                                <input type="text" id="bits-border-color" value="#2ed573">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Background</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="bits-bg-enabled">
                                <label for="bits-bg-enabled">Enable BG</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="bits-bg-color-group" style="display: none;">
                        <label>Background Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="bits-bg-color-picker" value="#000000">
                            <input type="text" id="bits-bg-color" value="rgba(0,0,0,0.3)">
                        </div>
                        <div class="control-group" style="margin-top: 10px;">
                            <label>Background Opacity</label>
                            <input type="range" id="bits-bg-opacity" min="0" max="100" value="30">
                            <div class="range-value"><span id="bits-bg-opacity-display">30</span>%</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Text Size</label>
                            <input type="range" id="bits-font-size" min="20" max="150" value="42">
                            <div class="range-value"><span id="bits-font-size-display">42</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Label Size</label>
                            <input type="range" id="bits-label-font-size" min="10" max="60" value="14">
                            <div class="range-value"><span id="bits-label-font-size-display">14</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Border</label>
                            <input type="range" id="bits-border-width" min="0" max="10" value="2">
                            <div class="range-value"><span id="bits-border-width-display">2</span>px</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Radius</label>
                            <input type="range" id="bits-border-radius" min="0" max="30" value="0">
                            <div class="range-value"><span id="bits-border-radius-display">0</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad V</label>
                            <input type="range" id="bits-padding-v" min="0" max="30" value="8">
                            <div class="range-value"><span id="bits-padding-v-display">8</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad H</label>
                            <input type="range" id="bits-padding-h" min="0" max="40" value="15">
                            <div class="range-value"><span id="bits-padding-h-display">15</span>px</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Widget -->
                <div class="widget-section">
                    <h3><span class="widget-color" style="background: #ff6b6b;"></span> Monthly Artists Widget</h3>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="monthly-text-color-picker" value="#ff6b6b">
                                <input type="text" id="monthly-text-color" value="#ff6b6b">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Label Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="monthly-label-color-picker" value="#aaaaaa">
                                <input type="text" id="monthly-label-color" value="#aaaaaa">
                            </div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Border Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="monthly-border-color-picker" value="#ff6b6b">
                                <input type="text" id="monthly-border-color" value="#ff6b6b">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Background</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="monthly-bg-enabled">
                                <label for="monthly-bg-enabled">Enable BG</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="monthly-bg-color-group" style="display: none;">
                        <label>Background Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="monthly-bg-color-picker" value="#000000">
                            <input type="text" id="monthly-bg-color" value="rgba(0,0,0,0.3)">
                        </div>
                        <div class="control-group" style="margin-top: 10px;">
                            <label>Background Opacity</label>
                            <input type="range" id="monthly-bg-opacity" min="0" max="100" value="30">
                            <div class="range-value"><span id="monthly-bg-opacity-display">30</span>%</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Text Size</label>
                            <input type="range" id="monthly-font-size" min="20" max="150" value="42">
                            <div class="range-value"><span id="monthly-font-size-display">42</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Label Size</label>
                            <input type="range" id="monthly-label-font-size" min="10" max="60" value="14">
                            <div class="range-value"><span id="monthly-label-font-size-display">14</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Border</label>
                            <input type="range" id="monthly-border-width" min="0" max="10" value="2">
                            <div class="range-value"><span id="monthly-border-width-display">2</span>px</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Radius</label>
                            <input type="range" id="monthly-border-radius" min="0" max="30" value="0">
                            <div class="range-value"><span id="monthly-border-radius-display">0</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad V</label>
                            <input type="range" id="monthly-padding-v" min="0" max="30" value="8">
                            <div class="range-value"><span id="monthly-padding-v-display">8</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad H</label>
                            <input type="range" id="monthly-padding-h" min="0" max="40" value="15">
                            <div class="range-value"><span id="monthly-padding-h-display">15</span>px</div>
                        </div>
                    </div>
                </div>

                <!-- Lifetime Widget -->
                <div class="widget-section">
                    <h3><span class="widget-color" style="background: #ffd700;"></span> Lifetime Artists Widget</h3>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="lifetime-text-color-picker" value="#ffd700">
                                <input type="text" id="lifetime-text-color" value="#ffd700">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Label Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="lifetime-label-color-picker" value="#aaaaaa">
                                <input type="text" id="lifetime-label-color" value="#aaaaaa">
                            </div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <label>Border Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="lifetime-border-color-picker" value="#ffd700">
                                <input type="text" id="lifetime-border-color" value="#ffd700">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Background</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="lifetime-bg-enabled">
                                <label for="lifetime-bg-enabled">Enable BG</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="lifetime-bg-color-group" style="display: none;">
                        <label>Background Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="lifetime-bg-color-picker" value="#000000">
                            <input type="text" id="lifetime-bg-color" value="rgba(0,0,0,0.3)">
                        </div>
                        <div class="control-group" style="margin-top: 10px;">
                            <label>Background Opacity</label>
                            <input type="range" id="lifetime-bg-opacity" min="0" max="100" value="30">
                            <div class="range-value"><span id="lifetime-bg-opacity-display">30</span>%</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Text Size</label>
                            <input type="range" id="lifetime-font-size" min="20" max="150" value="36">
                            <div class="range-value"><span id="lifetime-font-size-display">36</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Label Size</label>
                            <input type="range" id="lifetime-label-font-size" min="10" max="60" value="14">
                            <div class="range-value"><span id="lifetime-label-font-size-display">14</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Border</label>
                            <input type="range" id="lifetime-border-width" min="0" max="10" value="2">
                            <div class="range-value"><span id="lifetime-border-width-display">2</span>px</div>
                        </div>
                    </div>

                    <div class="control-row-3">
                        <div class="control-group control-small">
                            <label>Radius</label>
                            <input type="range" id="lifetime-border-radius" min="0" max="30" value="0">
                            <div class="range-value"><span id="lifetime-border-radius-display">0</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad V</label>
                            <input type="range" id="lifetime-padding-v" min="0" max="30" value="8">
                            <div class="range-value"><span id="lifetime-padding-v-display">8</span>px</div>
                        </div>
                        <div class="control-group control-small">
                            <label>Pad H</label>
                            <input type="range" id="lifetime-padding-h" min="0" max="40" value="15">
                            <div class="range-value"><span id="lifetime-padding-h-display">15</span>px</div>
                        </div>
                    </div>
                </div>

                <div class="button-row">
                    <button class="btn btn-primary" onclick="saveBranding()">Save Branding</button>
                    <button class="btn btn-secondary" onclick="resetBranding()">Reset to Default</button>
                </div>
                <div id="status-message" class="status-message"></div>
            </div>
        </div>

        <div class="preview-section">
            <div class="panel">
                <h2>Live Preview</h2>
                <p style="font-size: 12px; color: #666; margin-bottom: 15px;">Each widget has completely independent styling</p>
                
                <div class="preview-box">
                    <div class="sidebar2-preview">
                        <div class="preview-widget followers">
                            <div class="preview-label">Followers</div>
                            <div class="preview-value">1,234</div>
                        </div>
                        <div class="preview-widget subgoal">
                            <div class="preview-label">Subs Goal</div>
                            <div class="preview-value">23 / 150</div>
                        </div>
                        <div class="preview-widget bits">
                            <div class="preview-label">Bits Today</div>
                            <div class="preview-value">$12.34</div>
                        </div>
                        <div class="preview-widget monthly">
                            <div class="preview-label">Artists (Monthly)</div>
                            <div class="preview-value">$45</div>
                        </div>
                        <div class="preview-widget lifetime">
                            <div class="preview-label">Artists (Lifetime)</div>
                            <div class="preview-value">$1,250</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-top: 20px;">
                <h2>Export Configuration</h2>
                <p style="font-size: 13px; color: #a0aec0; margin-bottom: 15px;">This code will be saved to branding-setup.js:</p>
                <textarea id="export-code" style="width: 100%; height: 300px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; color: #a0aec0; font-family: monospace; font-size: 10px; resize: none;" readonly></textarea>
                <button class="btn btn-primary" style="margin-top: 15px;" onclick="copyExportCode()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        // Default modular configuration
        const defaultConfig = {
            fontFamily: "Bebas Neue",
            googleFont: true,
            fontWeight: "bold",
            textShadow: "2px 2px 4px rgba(0,0,0,0.8)",
            layout: {
                gap: 5
            },
            widgets: {
                followers: {
                    fontSize: 48,
                    labelFontSize: 14,
                    colors: {
                        text: "#9146ff",
                        label: "#aaaaaa",
                        border: "#9146ff",
                        background: "rgba(0,0,0,0.3)"
                    },
                    border: {
                        width: 2,
                        style: "solid",
                        radius: 0
                    },
                    background: {
                        enabled: false,
                        color: "rgba(0,0,0,0.3)",
                        opacity: 30
                    },
                    padding: {
                        vertical: 8,
                        horizontal: 15
                    }
                },
                bits: {
                    fontSize: 42,
                    labelFontSize: 14,
                    colors: {
                        text: "#2ed573",
                        label: "#aaaaaa",
                        border: "#2ed573",
                        background: "rgba(0,0,0,0.3)"
                    },
                    border: {
                        width: 2,
                        style: "solid",
                        radius: 0
                    },
                    background: {
                        enabled: false,
                        color: "rgba(0,0,0,0.3)",
                        opacity: 30
                    },
                    padding: {
                        vertical: 8,
                        horizontal: 15
                    }
                },
                subgoal: {
                    fontSize: 42,
                    labelFontSize: 14,
                    colors: {
                        text: "#00d2d3",
                        label: "#aaaaaa",
                        border: "#00d2d3",
                        background: "rgba(0,0,0,0.3)"
                    },
                    border: {
                        width: 2,
                        style: "solid",
                        radius: 0
                    },
                    background: {
                        enabled: false,
                        color: "rgba(0,0,0,0.3)",
                        opacity: 30
                    },
                    padding: {
                        vertical: 8,
                        horizontal: 15
                    }
                },
                monthly: {
                    fontSize: 42,
                    labelFontSize: 14,
                    colors: {
                        text: "#ff6b6b",
                        label: "#aaaaaa",
                        border: "#ff6b6b",
                        background: "rgba(0,0,0,0.3)"
                    },
                    border: {
                        width: 2,
                        style: "solid",
                        radius: 0
                    },
                    background: {
                        enabled: false,
                        color: "rgba(0,0,0,0.3)",
                        opacity: 30
                    },
                    padding: {
                        vertical: 8,
                        horizontal: 15
                    }
                },
                lifetime: {
                    fontSize: 36,
                    labelFontSize: 14,
                    colors: {
                        text: "#ffd700",
                        label: "#aaaaaa",
                        border: "#ffd700",
                        background: "rgba(0,0,0,0.3)"
                    },
                    border: {
                        width: 2,
                        style: "solid",
                        radius: 0
                    },
                    background: {
                        enabled: false,
                        color: "rgba(0,0,0,0.3)",
                        opacity: 30
                    },
                    padding: {
                        vertical: 8,
                        horizontal: 15
                    }
                }
            }
        };

        let currentConfig = JSON.parse(JSON.stringify(defaultConfig));

        const googleFonts = [
            "Bebas Neue", "Oswald", "Montserrat", "Poppins", "Roboto", "Open Sans",
            "Orbitron", "Russo One", "Black Ops One", "Press Start 2P", "Bungee",
            "Playfair Display", "Lato", "Raleway", "Nunito", "Work Sans",
            "Lobster", "Pacifico", "Permanent Marker", "Righteous", "Fredoka One"
        ];

        const widgets = ['followers', 'subgoal', 'bits', 'monthly', 'lifetime'];

        function init() {
            loadConfig();
            setupEventListeners();
            loadGoogleFont(currentConfig.fontFamily);
            updatePreview();
            updateExportCode();
        }

        function loadGoogleFont(fontName) {
            if (googleFonts.includes(fontName)) {
                const link = document.getElementById('google-font-link');
                const encodedFont = fontName.replace(/ /g, '+');
                link.href = `https://fonts.googleapis.com/css2?family=${encodedFont}:wght@400;700&display=swap`;
                document.getElementById('font-preview').style.fontFamily = `'${fontName}', sans-serif`;
            } else {
                document.getElementById('font-preview').style.fontFamily = fontName;
            }
        }

        function loadConfig() {
            try {
                const stored = localStorage.getItem('brandingConfig');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    // Merge with defaults to ensure all properties exist
                    currentConfig = JSON.parse(JSON.stringify(defaultConfig));
                    
                    // Apply stored values on top of defaults
                    if (parsed.fontFamily) currentConfig.fontFamily = parsed.fontFamily;
                    if (parsed.googleFont !== undefined) currentConfig.googleFont = parsed.googleFont;
                    if (parsed.layout) currentConfig.layout = { ...currentConfig.layout, ...parsed.layout };
                    
                    // Merge widgets if they exist
                    if (parsed.widgets) {
                        Object.keys(parsed.widgets).forEach(widget => {
                            if (currentConfig.widgets[widget]) {
                                currentConfig.widgets[widget] = { ...currentConfig.widgets[widget], ...parsed.widgets[widget] };
                                // Deep merge nested objects
                                if (parsed.widgets[widget].colors) {
                                    currentConfig.widgets[widget].colors = { ...currentConfig.widgets[widget].colors, ...parsed.widgets[widget].colors };
                                }
                                if (parsed.widgets[widget].border) {
                                    currentConfig.widgets[widget].border = { ...currentConfig.widgets[widget].border, ...parsed.widgets[widget].border };
                                }
                                if (parsed.widgets[widget].background) {
                                    currentConfig.widgets[widget].background = { ...currentConfig.widgets[widget].background, ...parsed.widgets[widget].background };
                                }
                                if (parsed.widgets[widget].padding) {
                                    currentConfig.widgets[widget].padding = { ...currentConfig.widgets[widget].padding, ...parsed.widgets[widget].padding };
                                }
                            }
                        });
                    }
                }
            } catch (e) {
                console.error('Error loading config:', e);
                currentConfig = JSON.parse(JSON.stringify(defaultConfig));
            }
            applyToControls();
        }

        function applyToControls() {
            document.getElementById('font-family').value = currentConfig.fontFamily;
            document.getElementById('gap').value = currentConfig.layout.gap;
            document.getElementById('gap-display').textContent = currentConfig.layout.gap;

            widgets.forEach(widget => {
                const w = currentConfig.widgets[widget];
                if (!w) {
                    console.warn(`Widget ${widget} not found in config`);
                    return;
                }

                // Colors
                document.getElementById(`${widget}-text-color`).value = w.colors.text;
                document.getElementById(`${widget}-text-color-picker`).value = w.colors.text;
                document.getElementById(`${widget}-label-color`).value = w.colors.label;
                document.getElementById(`${widget}-label-color-picker`).value = w.colors.label;
                document.getElementById(`${widget}-border-color`).value = w.colors.border;
                document.getElementById(`${widget}-border-color-picker`).value = w.colors.border;

                // Background
                document.getElementById(`${widget}-bg-enabled`).checked = w.background.enabled;
                document.getElementById(`${widget}-bg-color`).value = w.background.color;
                document.getElementById(`${widget}-bg-color-picker`).value = rgbToHex(w.background.color) || '#000000';
                document.getElementById(`${widget}-bg-color-group`).style.display = w.background.enabled ? 'block' : 'none';
                
                // Opacity (allow 0 as a valid value)
                const opacity = w.background.opacity === undefined ? 30 : w.background.opacity;
                document.getElementById(`${widget}-bg-opacity`).value = opacity;
                document.getElementById(`${widget}-bg-opacity-display`).textContent = opacity;

                // Font sizes
                document.getElementById(`${widget}-font-size`).value = w.fontSize;
                document.getElementById(`${widget}-font-size-display`).textContent = w.fontSize;
                document.getElementById(`${widget}-label-font-size`).value = w.labelFontSize;
                document.getElementById(`${widget}-label-font-size-display`).textContent = w.labelFontSize;

                // Border
                document.getElementById(`${widget}-border-width`).value = w.border.width;
                document.getElementById(`${widget}-border-width-display`).textContent = w.border.width;
                document.getElementById(`${widget}-border-radius`).value = w.border.radius;
                document.getElementById(`${widget}-border-radius-display`).textContent = w.border.radius;

                // Padding
                document.getElementById(`${widget}-padding-v`).value = w.padding.vertical;
                document.getElementById(`${widget}-padding-v-display`).textContent = w.padding.vertical;
                document.getElementById(`${widget}-padding-h`).value = w.padding.horizontal;
                document.getElementById(`${widget}-padding-h-display`).textContent = w.padding.horizontal;
            });
        }

        function rgbToHex(rgba) {
            // If it's already a hex color, return it
            if (rgba && rgba.startsWith('#')) {
                return rgba;
            }
            // If it's an rgba string, extract the hex
            const match = rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
            if (match) {
                const r = parseInt(match[1]);
                const g = parseInt(match[2]);
                const b = parseInt(match[3]);
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            }
            return null;
        }

        function setupEventListeners() {
            // Global font
            document.getElementById('font-family').addEventListener('change', (e) => {
                currentConfig.fontFamily = e.target.value;
                currentConfig.googleFont = googleFonts.includes(e.target.value);
                loadGoogleFont(e.target.value);
                updatePreview();
                updateExportCode();
            });

            // Global gap
            document.getElementById('gap').addEventListener('input', (e) => {
                currentConfig.layout.gap = parseInt(e.target.value);
                document.getElementById('gap-display').textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            // Widget-specific listeners
            widgets.forEach(widget => {
                setupWidgetListeners(widget);
            });
        }

        function setupWidgetListeners(widget) {
            const w = currentConfig.widgets[widget];

            // Color pickers
            const colorFields = ['text-color', 'label-color', 'border-color'];
            colorFields.forEach(field => {
                const picker = document.getElementById(`${widget}-${field}-picker`);
                const text = document.getElementById(`${widget}-${field}`);
                const colorKey = field.replace('-color', '');

                picker.addEventListener('input', (e) => {
                    text.value = e.target.value;
                    w.colors[colorKey] = e.target.value;
                    updatePreview();
                    updateExportCode();
                });

                text.addEventListener('input', (e) => {
                    if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
                        picker.value = e.target.value;
                        w.colors[colorKey] = e.target.value;
                        updatePreview();
                        updateExportCode();
                    }
                });
            });

            // Background
            document.getElementById(`${widget}-bg-enabled`).addEventListener('change', (e) => {
                w.background.enabled = e.target.checked;
                document.getElementById(`${widget}-bg-color-group`).style.display = e.target.checked ? 'block' : 'none';
                updatePreview();
                updateExportCode();
            });

            document.getElementById(`${widget}-bg-color`).addEventListener('input', (e) => {
                w.background.color = e.target.value;
                updatePreview();
                updateExportCode();
            });

            // Background color picker (the visible one)
            document.getElementById(`${widget}-bg-color-picker`).addEventListener('input', (e) => {
                const color = e.target.value;
                document.getElementById(`${widget}-bg-color`).value = color;
                w.background.color = color;
                // Ensure opacity is set (default to 30 if not set)
                if (!w.background.opacity) {
                    w.background.opacity = 30;
                }
                updatePreview();
                updateExportCode();
            });

            // Background opacity
            document.getElementById(`${widget}-bg-opacity`).addEventListener('input', (e) => {
                w.background.opacity = parseInt(e.target.value);
                document.getElementById(`${widget}-bg-opacity-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            // Font sizes
            document.getElementById(`${widget}-font-size`).addEventListener('input', (e) => {
                w.fontSize = parseInt(e.target.value);
                document.getElementById(`${widget}-font-size-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            document.getElementById(`${widget}-label-font-size`).addEventListener('input', (e) => {
                w.labelFontSize = parseInt(e.target.value);
                document.getElementById(`${widget}-label-font-size-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            // Border
            document.getElementById(`${widget}-border-width`).addEventListener('input', (e) => {
                w.border.width = parseInt(e.target.value);
                document.getElementById(`${widget}-border-width-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            document.getElementById(`${widget}-border-radius`).addEventListener('input', (e) => {
                w.border.radius = parseInt(e.target.value);
                document.getElementById(`${widget}-border-radius-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            // Padding
            document.getElementById(`${widget}-padding-v`).addEventListener('input', (e) => {
                w.padding.vertical = parseInt(e.target.value);
                document.getElementById(`${widget}-padding-v-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });

            document.getElementById(`${widget}-padding-h`).addEventListener('input', (e) => {
                w.padding.horizontal = parseInt(e.target.value);
                document.getElementById(`${widget}-padding-h-display`).textContent = e.target.value;
                updatePreview();
                updateExportCode();
            });
        }

        function updatePreview() {
            const root = document.documentElement;

            // Global
            root.style.setProperty('--preview-gap', currentConfig.layout.gap + 'px');
            root.style.setProperty('--preview-font-family', `'${currentConfig.fontFamily}', sans-serif`);

            // Widgets
            widgets.forEach(widget => {
                const w = currentConfig.widgets[widget];
                if (!w) return;

                const prefix = `--${widget}`;

                // Colors
                root.style.setProperty(`${prefix}-text`, w.colors.text);
                root.style.setProperty(`${prefix}-label`, w.colors.label);
                root.style.setProperty(`${prefix}-border-color`, w.colors.border);

                // Background with opacity
                if (w.background.enabled) {
                    const hex = rgbToHex(w.background.color) || '#000000';
                    // Use 0 if opacity is 0, otherwise use stored value or default to 30
                    const opacity = (w.background.opacity === 0 ? 0 : (w.background.opacity || 30)) / 100;
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    root.style.setProperty(`${prefix}-bg`, `rgba(${r}, ${g}, ${b}, ${opacity})`);
                } else {
                    root.style.setProperty(`${prefix}-bg`, 'transparent');
                }

                // Font sizes
                root.style.setProperty(`${prefix}-size`, w.fontSize + 'px');
                root.style.setProperty(`${prefix}-label-size`, w.labelFontSize + 'px');

                // Border
                root.style.setProperty(`${prefix}-border-width`, w.border.width + 'px');
                root.style.setProperty(`${prefix}-border-style`, w.border.style);
                root.style.setProperty(`${prefix}-radius`, w.border.radius + 'px');

                // Padding
                root.style.setProperty(`${prefix}-padding`, `${w.padding.vertical}px ${w.padding.horizontal}px`);
            });
        }

        function updateExportCode() {
            const code = generateBrandingJS(currentConfig);
            document.getElementById('export-code').value = code;
        }

        function generateBrandingJS(config) {
            return `// Central Configuration for All Widgets
// Generated by Branding Settings
// Modular - Each widget has independent styling

const DEFAULT_CONFIG = {
    fontFamily: "${config.fontFamily}",
    googleFont: ${config.googleFont},
    fontWeight: "bold",
    textShadow: "2px 2px 4px rgba(0,0,0,0.8)",
    
    layout: {
        gap: ${config.layout.gap}
    },
    
    widgets: {
        followers: {
            fontSize: ${config.widgets.followers.fontSize},
            labelFontSize: ${config.widgets.followers.labelFontSize},
            colors: {
                text: "${config.widgets.followers.colors.text}",
                label: "${config.widgets.followers.colors.label}",
                border: "${config.widgets.followers.colors.border}",
                background: "${config.widgets.followers.colors.background}"
            },
            border: {
                width: ${config.widgets.followers.border.width},
                style: "${config.widgets.followers.border.style}",
                radius: ${config.widgets.followers.border.radius}
            },
            background: {
                enabled: ${config.widgets.followers.background.enabled},
                color: "${config.widgets.followers.background.color}",
                opacity: ${config.widgets.followers.background.opacity || 30}
            },
            padding: {
                vertical: ${config.widgets.followers.padding.vertical},
                horizontal: ${config.widgets.followers.padding.horizontal}
            }
        },
        bits: {
            fontSize: ${config.widgets.bits.fontSize},
            labelFontSize: ${config.widgets.bits.labelFontSize},
            colors: {
                text: "${config.widgets.bits.colors.text}",
                label: "${config.widgets.bits.colors.label}",
                border: "${config.widgets.bits.colors.border}",
                background: "${config.widgets.bits.colors.background}"
            },
            border: {
                width: ${config.widgets.bits.border.width},
                style: "${config.widgets.bits.border.style}",
                radius: ${config.widgets.bits.border.radius}
            },
            background: {
                enabled: ${config.widgets.bits.background.enabled},
                color: "${config.widgets.bits.background.color}",
                opacity: ${config.widgets.bits.background.opacity || 30}
            },
            padding: {
                vertical: ${config.widgets.bits.padding.vertical},
                horizontal: ${config.widgets.bits.padding.horizontal}
            }
        },
        subgoal: {
            fontSize: ${config.widgets.subgoal.fontSize},
            labelFontSize: ${config.widgets.subgoal.labelFontSize},
            colors: {
                text: "${config.widgets.subgoal.colors.text}",
                label: "${config.widgets.subgoal.colors.label}",
                border: "${config.widgets.subgoal.colors.border}",
                background: "${config.widgets.subgoal.colors.background}"
            },
            border: {
                width: ${config.widgets.subgoal.border.width},
                style: "${config.widgets.subgoal.border.style}",
                radius: ${config.widgets.subgoal.border.radius}
            },
            background: {
                enabled: ${config.widgets.subgoal.background.enabled},
                color: "${config.widgets.subgoal.background.color}",
                opacity: ${config.widgets.subgoal.background.opacity || 30}
            },
            padding: {
                vertical: ${config.widgets.subgoal.padding.vertical},
                horizontal: ${config.widgets.subgoal.padding.horizontal}
            }
        },
        monthly: {
            fontSize: ${config.widgets.monthly.fontSize},
            labelFontSize: ${config.widgets.monthly.labelFontSize},
            colors: {
                text: "${config.widgets.monthly.colors.text}",
                label: "${config.widgets.monthly.colors.label}",
                border: "${config.widgets.monthly.colors.border}",
                background: "${config.widgets.monthly.colors.background}"
            },
            border: {
                width: ${config.widgets.monthly.border.width},
                style: "${config.widgets.monthly.border.style}",
                radius: ${config.widgets.monthly.border.radius}
            },
            background: {
                enabled: ${config.widgets.monthly.background.enabled},
                color: "${config.widgets.monthly.background.color}",
                opacity: ${config.widgets.monthly.background.opacity || 30}
            },
            padding: {
                vertical: ${config.widgets.monthly.padding.vertical},
                horizontal: ${config.widgets.monthly.padding.horizontal}
            }
        },
        lifetime: {
            fontSize: ${config.widgets.lifetime.fontSize},
            labelFontSize: ${config.widgets.lifetime.labelFontSize},
            colors: {
                text: "${config.widgets.lifetime.colors.text}",
                label: "${config.widgets.lifetime.colors.label}",
                border: "${config.widgets.lifetime.colors.border}",
                background: "${config.widgets.lifetime.colors.background}"
            },
            border: {
                width: ${config.widgets.lifetime.border.width},
                style: "${config.widgets.lifetime.border.style}",
                radius: ${config.widgets.lifetime.border.radius}
            },
            background: {
                enabled: ${config.widgets.lifetime.background.enabled},
                color: "${config.widgets.lifetime.background.color}",
                opacity: ${config.widgets.lifetime.background.opacity || 30}
            },
            padding: {
                vertical: ${config.widgets.lifetime.padding.vertical},
                horizontal: ${config.widgets.lifetime.padding.horizontal}
            }
        }
    }
};

let WIDGET_CONFIG = JSON.parse(JSON.stringify(DEFAULT_CONFIG));

function loadBrandingConfig() {
    try {
        const stored = localStorage.getItem('brandingConfig');
        if (stored) {
            const parsed = JSON.parse(stored);
            WIDGET_CONFIG = deepMerge(DEFAULT_CONFIG, parsed);
        }
    } catch (e) {
        WIDGET_CONFIG = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
    }
}

function deepMerge(defaults, overrides) {
    const result = JSON.parse(JSON.stringify(defaults));
    for (const key in overrides) {
        if (overrides.hasOwnProperty(key)) {
            if (typeof overrides[key] === 'object' && overrides[key] !== null && !Array.isArray(overrides[key])) {
                result[key] = deepMerge(result[key] || {}, overrides[key]);
            } else {
                result[key] = overrides[key];
            }
        }
    }
    return result;
}

function loadGoogleFont(fontName) {
    if (WIDGET_CONFIG.googleFont && fontName) {
        const encodedFont = fontName.replace(/ /g, '+');
        const linkId = 'google-font-dynamic';
        let link = document.getElementById(linkId);
        if (!link) {
            link = document.createElement('link');
            link.id = linkId;
            link.rel = 'stylesheet';
            document.head.appendChild(link);
        }
        link.href = 'https://fonts.googleapis.com/css2?family=' + encodedFont + ':wght@400;700&display=swap';
    }
}

function applyWidgetStyles() {
    loadBrandingConfig();
    loadGoogleFont(WIDGET_CONFIG.fontFamily);
    
    const root = document.documentElement;
    
    root.style.setProperty('--font-family', WIDGET_CONFIG.fontFamily);
    root.style.setProperty('--font-weight', WIDGET_CONFIG.fontWeight);
    root.style.setProperty('--text-shadow', WIDGET_CONFIG.textShadow);
    root.style.setProperty('--gap', WIDGET_CONFIG.layout.gap + 'px');
    
    const widgets = ['followers', 'subgoal', 'bits', 'monthly', 'lifetime'];
    
    widgets.forEach(widget => {
        const config = WIDGET_CONFIG.widgets[widget];
        if (!config) return;
        
        const prefix = '--widget-' + widget;
        
        root.style.setProperty(prefix + '-font-size', config.fontSize + 'px');
        root.style.setProperty(prefix + '-label-font-size', config.labelFontSize + 'px');
        root.style.setProperty(prefix + '-text-color', config.colors.text);
        root.style.setProperty(prefix + '-label-color', config.colors.label);
        root.style.setProperty(prefix + '-border-color', config.colors.border);
        
        if (config.background.enabled) {
            root.style.setProperty(prefix + '-bg-color', config.background.color);
        } else {
            root.style.setProperty(prefix + '-bg-color', 'transparent');
        }
        
        root.style.setProperty(prefix + '-border-width', config.border.width + 'px');
        root.style.setProperty(prefix + '-border-style', config.border.style);
        root.style.setProperty(prefix + '-border-radius', config.border.radius + 'px');
        root.style.setProperty(prefix + '-padding', config.padding.vertical + 'px ' + config.padding.horizontal + 'px');
    });
}

document.addEventListener('DOMContentLoaded', applyWidgetStyles);`;
        }

        async function saveBranding() {
            try {
                localStorage.setItem('brandingConfig', JSON.stringify(currentConfig));
                
                const response = await fetch('/api/save-branding', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentConfig)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('âœ“ Branding saved! File updated successfully.', true);
                } else {
                    showStatus('âš  Saved to browser only. File update failed: ' + result.error, false);
                }
            } catch (e) {
                localStorage.setItem('brandingConfig', JSON.stringify(currentConfig));
                showStatus('âš  Saved to browser only. Run "python twitch_stats.py" first.', false);
            }
        }

        function resetBranding() {
            // Clear localStorage to remove old/corrupted data
            localStorage.removeItem('brandingConfig');
            currentConfig = JSON.parse(JSON.stringify(defaultConfig));
            applyToControls();
            loadGoogleFont(currentConfig.fontFamily);
            updatePreview();
            updateExportCode();
            showStatus('Reset to defaults - old data cleared', true);
        }

        function showStatus(message, success) {
            const el = document.getElementById('status-message');
            el.textContent = message;
            el.className = 'status-message ' + (success ? 'success' : 'error');
            setTimeout(() => {
                el.className = 'status-message';
            }, 5000);
        }

        function copyExportCode() {
            const textarea = document.getElementById('export-code');
            textarea.select();
            document.execCommand('copy');
            showStatus('Copied to clipboard!', true);
        }

        init();
    </script>
</body>
</html>
